<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DINC GESTÃO - Novo Caminho</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .loading-overlay { display: none; background: rgba(0,0,0,0.6); position: fixed; inset: 0; z-index: 999; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .loading-overlay.active { display: flex; }
        .status-badge { padding: 4px 12px; border-radius: 9999px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
        .status-pendente { background-color: #fef3c7; color: #92400e; }
        .status-ativo { background-color: #d1fae5; color: #065f46; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans">

    <div id="loader" class="loading-overlay flex flex-col gap-4 text-white">
        <i class="fa-solid fa-circle-notch fa-spin text-5xl"></i>
        <span class="font-bold text-xs uppercase tracking-widest">Sincronizando Gestão...</span>
    </div>

    <div id="app" class="flex h-screen overflow-hidden">
        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white shadow-sm h-16 flex items-center justify-between px-8">
                <h2 class="text-xl font-black text-indigo-900 italic tracking-tighter">DINC GESTÃO</h2>
                <div class="flex items-center gap-4">
                    <button onclick="atualizarDados()" class="text-indigo-600 hover:rotate-180 transition-all p-2"><i class="fa-solid fa-rotate"></i></button>
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold" id="userIcon">A</div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-8">
                <div id="listaCards" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    </div>
            </div>
        </main>
    </div>

<script>
    // URL da API de Gestão (O novo Web App que você criou)
// CERTIFIQUE-SE DE QUE ESTA URL TERMINA COM /exec
const API_GESTAO = "https://script.google.com/macros/s/AKfycbwqjPBQMQ3x0yZNPjh1RqEeZH_Wc7F2-GpVpGVERGd6MyjssvyUiegRV8wWW9n48Szv/exec";
let DADOS_CACHE = [];

async function atualizarDados() {
    showLoader(true);
    try {
        // Usamos a URL com parâmetro action para o doGet do Apps Script
        const response = await fetch(`${API_GESTAO}?action=getDados`);
        
        if (!response.ok) throw new Error("Falha na rede");
        
        DADOS_CACHE = await response.json();
        renderizar();
    } catch (err) {
        console.error("Erro na sincronização:", err);
        alert("Erro ao conectar com o cérebro da operação. Verifique se o Script foi publicado como 'Qualquer Pessoa'.");
        // Remove o loader mesmo em caso de erro para não travar a tela
        showLoader(false);
    } finally {
        showLoader(false);
    }
}

function renderizar() {
    const container = document.getElementById('listaCards');
    if (!DADOS_CACHE || DADOS_CACHE.length === 0) {
        container.innerHTML = '<p class="col-span-full text-center py-10 text-gray-400 font-bold uppercase">Nenhum registro encontrado.</p>';
        return;
    }

    container.innerHTML = DADOS_CACHE.map(item => `
        <div class="bg-white p-6 rounded-3xl shadow-md border border-slate-100 relative overflow-hidden transition-all hover:shadow-xl">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="font-black text-indigo-900 leading-tight uppercase tracking-tighter">${item.nome || 'Sem Nome'}</h3>
                    <p class="text-[10px] text-slate-400 font-bold uppercase mt-1">${item.tipo || 'N/A'} | ${item.data || ''}</p>
                </div>
                <button onclick="window.open('https://api.whatsapp.com/send?phone=55${String(item.telefone).replace(/\D/g,'')}')" class="bg-emerald-100 text-emerald-600 p-3 rounded-2xl">
                    <i class="fa-brands fa-whatsapp text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-3 pt-3 border-t border-slate-50">
                <div class="flex items-center justify-between">
                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Status</span>
                    <span class="status-badge ${String(item.status).includes('Pendente') ? 'status-pendente' : 'status-ativo'}">${item.status || 'Pendente'}</span>
                </div>
                <div class="bg-slate-50 p-3 rounded-2xl border border-slate-100">
                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">Observações do Cadastro</p>
                    <p class="text-xs text-slate-600 italic font-medium leading-relaxed">${item.observacoes || 'Sem observações registradas.'}</p>
                </div>
            </div>
        </div>
    `).join('');
}

    function showLoader(s) { document.getElementById('loader').classList.toggle('active', s); }

    // Inicia automático
    window.onload = atualizarDados;
</script>
</body>
</html>
